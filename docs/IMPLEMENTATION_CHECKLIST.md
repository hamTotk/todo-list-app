# 実装チェックリスト

このドキュメントは、各フェーズの実装タスクをチェックリスト形式で管理します。

---

## フェーズ0: ドキュメント作成（実装前準備）

- [x] PROJECT_OVERVIEW.md 作成
- [x] DATA_MODEL.md 作成
- [x] API_REFERENCE.md 作成
- [x] IMPLEMENTATION_CHECKLIST.md 作成（このファイル）

---

## フェーズ1: 基本構造とUI

### 1-1. ファイル作成

- [x] `index.html` 作成
  - [x] セマンティックHTML構造
  - [x] ヘッダー要素
  - [x] サイドバー要素
  - [x] メインコンテンツエリア
  - [x] フッター要素
  - [x] TODOモーダル
  - [x] 確認ダイアログ

- [x] `css/themes.css` 作成
  - [x] CSS変数定義（ライトテーマ）
  - [x] CSS変数定義（ダークテーマ）
  - [x] `prefers-color-scheme` メディアクエリ

- [x] `css/styles.css` 作成
  - [x] リセットCSS/ベーススタイル
  - [x] レイアウト（グリッド、フレックス）
  - [x] ヘッダースタイル
  - [x] サイドバースタイル
  - [x] TODOリストスタイル
  - [x] モーダルスタイル
  - [x] フォームスタイル
  - [x] ボタンスタイル
  - [x] レスポンシブ対応

### 1-2. 基本レイアウトの確認

- [x] ヘッダーが正しく表示される
- [x] サイドバーが正しく表示される
- [x] メインエリアが正しく表示される
- [x] フッターが正しく表示される
- [x] モーダルが正しく表示される
- [x] レスポンシブデザインが機能する

---

## フェーズ2: データ層の実装

### 2-1. storage.js の実装

- [x] `loadTodos()` 実装
  - [x] LocalStorageから読み込み
  - [x] パースエラーハンドリング
  - [x] 空データ時のデフォルト値

- [x] `saveTodos(todos)` 実装
  - [x] LocalStorageに保存
  - [x] 容量超過エラーハンドリング
  - [x] 成功/失敗の戻り値

- [x] `loadSettings()` 実装
  - [x] 設定データの読み込み
  - [x] デフォルト設定の提供

- [x] `saveSettings(settings)` 実装
  - [x] 設定データの保存

- [x] `clearAllData()` 実装
  - [x] 全データの削除（デバッグ用）

### 2-2. todo.js の実装

- [x] `TodoManager` クラス作成
  - [x] コンストラクタ
  - [x] プライベート変数（todos配列）

- [x] CRUD操作
  - [x] `createTodo(data)` 実装
    - [x] ID生成
    - [x] バリデーション
    - [x] デフォルト値の設定
    - [x] タイムスタンプ設定
  - [x] `getTodo(id)` 実装
  - [x] `getAllTodos()` 実装
  - [x] `updateTodo(id, updates)` 実装
    - [x] バリデーション
    - [x] updatedAt更新
  - [x] `deleteTodo(id)` 実装
    - [x] サブタスクのカスケード削除
  - [x] `toggleComplete(id)` 実装

- [x] フィルタリング・ソート
  - [x] `filterTodos(filters)` 実装
    - [x] カテゴリフィルター
    - [x] タグフィルター
    - [x] 優先度フィルター
    - [x] 完了状態フィルター
  - [x] `sortTodos(todos, sortBy, sortOrder)` 実装
    - [x] 作成日時ソート
    - [x] 期限ソート
    - [x] 優先度ソート
    - [x] タイトルソート

- [x] バリデーション
  - [x] `validateTodo(data)` 実装
    - [x] タイトル必須チェック
    - [x] 文字数制限チェック
    - [x] 日付形式チェック
    - [x] 優先度値チェック

- [x] ユーティリティ
  - [x] `getDueDateStatus(dueDate)` 実装
    - [x] 期限切れ判定
    - [x] 今日が期限判定
    - [x] 明日が期限判定
  - [x] `generateId()` 実装

### 2-3. テスト

- [x] storage.jsのテスト
  - [x] 保存・読み込みが正常に動作
  - [x] エラーハンドリングが機能

- [x] todo.jsのテスト
  - [x] CRUD操作が正常に動作
  - [x] フィルタリングが正常に動作
  - [x] ソートが正常に動作
  - [x] バリデーションが機能

---

## フェーズ3: UI層の実装

### 3-1. ui.js の実装

- [x] `UIManager` クラス作成
  - [x] コンストラクタ
  - [x] DOM要素の参照を保持

- [x] 初期化
  - [x] `init()` 実装
  - [x] `bindEvents()` 実装
    - [x] TODO追加ボタン
    - [x] モーダル開閉
    - [x] フォーム送信
    - [x] フィルター変更
    - [x] ソート変更
    - [x] 削除ボタン
    - [x] 完了チェックボックス

- [x] レンダリング
  - [x] `render()` 実装
  - [x] `renderTodoList()` 実装
    - [x] フィルター適用
    - [x] ソート適用
    - [x] 空状態の表示
  - [x] `renderTodoItem(todo)` 実装
    - [x] タイトル表示
    - [x] 優先度バッジ
    - [x] 期限表示と色分け
    - [x] カテゴリ・タグ表示
    - [x] 完了チェックボックス
    - [x] 編集・削除ボタン
  - [x] `updateStats()` 実装
    - [x] 全体数
    - [x] 完了数
    - [x] 未完了数

- [x] モーダル管理
  - [x] `openTodoModal(todoId)` 実装
    - [x] 新規作成時
    - [x] 編集時（既存データ読み込み）
    - [x] フォームのリセット
  - [x] `closeTodoModal()` 実装
    - [x] フォームのクリア

- [x] ユーティリティ
  - [x] `showConfirmDialog(message)` 実装
  - [x] `showError(message)` 実装

### 3-2. app.js の実装

- [x] `App` クラス作成
  - [x] コンストラクタ
  - [x] TodoManagerインスタンス作成
  - [x] UIManagerインスタンス作成

- [x] 初期化
  - [x] `init()` 実装
    - [x] データ読み込み
    - [x] UI初期化
    - [x] テーマ初期化
  - [x] `initTheme()` 実装
    - [x] システム設定の検出
    - [x] 保存された設定の読み込み
    - [x] テーマ切り替えイベント

- [x] アプリ起動
  - [x] DOMContentLoadedイベントでApp初期化

### 3-3. テスト

- [x] UIの動作確認
  - [x] TODOの表示が正常
  - [x] モーダルの開閉が正常
  - [x] フォームが正常に動作
  - [x] イベントが正常に発火

---

## フェーズ4: コア機能の実装

### 4-1. TODO操作機能

- [x] TODO追加
  - [x] フォームからデータ取得
  - [x] バリデーション
  - [x] 作成処理
  - [x] UIの更新
  - [x] モーダルを閉じる

- [x] TODO編集
  - [x] 編集ボタンクリック
  - [x] モーダルに既存データを表示
  - [x] 更新処理
  - [x] UIの更新

- [x] TODO削除
  - [x] 削除ボタンクリック
  - [x] 確認ダイアログ表示
  - [x] 削除処理
  - [x] UIの更新

- [x] 完了切り替え
  - [x] チェックボックスクリック
  - [x] 完了状態の切り替え
  - [x] UIの更新

### 4-2. タグ管理（旧カテゴリ・タグ管理）

- [x] タグ管理 ※フェーズ8-1cで統合・刷新
  - [x] タグ追加UI
  - [x] タグ追加処理
  - [x] タグフィルター（複数選択、OR条件）
  - [x] タグ選択UI（フォーム、チェックボックス）
  - [x] タグ編集・削除機能
  - [x] タグ管理モーダル

### 4-3. 優先度とソート

- [x] 優先度表示
  - [x] 優先度バッジの色分け
  - [x] 優先度フィルター

- [x] ソート機能
  - [x] ソート基準の選択UI
  - [x] ソート順の切り替えUI
  - [x] ソート処理の実行
  - [x] UIの更新

### 4-4. 期限管理

- [x] 期限入力
  - [x] date input要素
  - [x] 日付選択

- [x] 期限表示
  - [x] 期限日の表示
  - [x] 期限状態の判定
  - [x] 色分け表示
    - [x] 期限切れ（赤）
    - [x] 今日が期限（オレンジ）
    - [x] 明日が期限（黄色）
    - [x] それ以降（通常）

### 4-5. テスト

- [x] 全ての基本機能が正常に動作
- [x] エラーハンドリングが機能
- [x] UIが適切に更新される

---

## フェーズ5: ダークモード実装

### 5-1. ダークモード実装

- [x] CSS変数の定義
  - [x] ライトテーマ変数
  - [x] ダークテーマ変数

- [x] テーマ切り替え
  - [x] テーマ切り替えボタン
  - [x] `data-theme` 属性の切り替え
  - [x] LocalStorageに保存

- [x] システム設定の自動検出
  - [x] `prefers-color-scheme` の検出
  - [x] 初回起動時にシステム設定を適用

### 5-2. テスト

- [x] ライトモードが正常に表示
- [x] ダークモードが正常に表示
- [x] 切り替えが正常に動作
- [x] 設定が保存される

---

## フェーズ6: サブタスク機能

### 6-1. サブタスクのデータ構造とロジック

- [x] 親子関係の管理
  - [x] `addSubtask(parentId, subtaskData)` 実装
  - [x] `getSubtasks(parentId)` 実装

- [x] 階層構造の検証
  - [x] `hasCircularReference(parentId, childId)` 実装
  - [x] 循環参照の防止

- [x] カスケード操作
  - [x] 親削除時に子も削除（再帰的削除）
  - [x] 親完了時の処理（警告→子も完了）

- [x] 進捗関連メソッド
  - [x] `getSubtaskProgress(parentId)` 実装
  - [x] `getIncompleteSubtasksCount(parentId)` 実装
  - [x] `completeAllSubtasks(parentId)` 実装

### 6-2. サブタスクのUI実装

- [x] 階層表示
  - [x] インデント表示（レベルに応じた左マージン）
  - [x] ツリー構造のレンダリング
  - [x] `renderTodoItem(todo, level, skipAnimation)` 拡張

- [x] 展開/折りたたみ
  - [x] 展開ボタン（▼）
  - [x] 折りたたみボタン（▶）
  - [x] 状態の保存（LocalStorage）

- [x] サブタスク追加
  - [x] サブタスク追加ボタン（+）（各タスクに配置）
  - [x] サブタスク追加処理
  - [x] UIの更新

- [x] 進捗表示
  - [x] 完了数/全体数の表示（例: 2/5）

### 6-3. 親タスクの完了処理

- [x] 未完了の子をチェック
- [x] 警告ダイアログ表示
  - [x] 「未完了の子タスクがあります」メッセージ
  - [x] 「すべて完了にする」ボタン
  - [x] 「キャンセル」ボタン

- [x] 全ての子を完了にする処理
- [x] 完了状態の連鎖更新

### 6-4. テスト

- [x] サブタスクの追加が正常に動作
- [x] 階層表示が正常に動作
- [x] 展開/折りたたみが機能
- [x] 循環参照が防止される
- [x] カスケード削除が機能
- [x] 親完了時の警告が表示される

---

## フェーズ7: 繰り返しタスク機能

### 7-1. 繰り返しタスクのデータ構造とロジック

- [x] 日付計算ユーティリティ
  - [x] `calculateNextDueDate(currentDate, recurrence)` 実装
    - [x] daily計算
    - [x] weekly計算
    - [x] monthly計算
    - [x] custom計算
  - [x] `getNextWeekday(currentDate, weekdays)` 実装

- [x] 終了条件のチェック
  - [x] 回数チェック
  - [x] 日付チェック

### 7-2. 繰り返しタスクの生成処理

- [x] `handleTaskCompletion(id)` 実装
  - [x] 繰り返し設定のチェック
  - [x] completionBehaviorに応じた処理
    - [x] createNext: 即座に次回分を生成
    - [x] reset: 完了状態をリセット
    - [x] createOnDue: 何もしない

- [x] `generateNextRecurrence(todo)` 実装
  - [x] 次回の期限日を計算
  - [x] 新しいタスクを作成
  - [x] originalTaskIdを設定
  - [x] completedCountをインクリメント

- [x] `checkScheduledRecurrences()` 実装
  - [x] createOnDueモードのタスクをチェック
  - [x] 期限が来たタスクを生成

- [x] アプリ起動時のスケジュールチェック
  - [x] app.jsで`checkScheduledRecurrences()`を呼び出し

### 7-3. 繰り返し設定UI

- [x] 繰り返し設定フォーム
  - [x] 繰り返し有効/無効チェックボックス
  - [x] 繰り返しタイプ選択
    - [x] 毎日
    - [x] 毎週
    - [x] 毎月
    - [x] カスタム間隔
    - [x] 曜日指定
  - [x] カスタム間隔入力
  - [x] 曜日選択チェックボックス（日〜土）
  - [x] 終了条件設定
    - [x] 無期限
    - [x] 回数指定
    - [x] 日付指定
  - [x] 完了時の挙動選択
    - [x] 即座に次回分を生成
    - [x] 期限になったら生成
    - [x] リセットして繰り返し

- [x] 繰り返しタスクの視覚的表示
  - [x] 繰り返しアイコン
  - [x] 繰り返しラベル

- [x] 完了履歴の表示（オプション）
  - [x] 完了回数の表示

### 7-4. テスト

- [x] 日付計算が正確
- [x] 繰り返しタスクの生成が正常
- [x] 終了条件が機能
- [x] completionBehaviorが正常に動作
- [x] UIが正常に動作

---

## フェーズ8: UX改善

### 8-1. 使いやすさの向上

- [x] キーボードショートカット
  - [x] Ctrl+Enter / Cmd+Enter: フォーム保存
  - [x] Esc: モーダルを閉じる

- [x] アニメーション
  - [x] TODO追加時のフェードイン（slideIn）
  - [x] TODO削除時のフェードアウト
  - [x] モーダルのアニメーション
  - [x] **タスク完了時のお祝いエフェクト**
    - [x] カードの拡大縮小アニメーション
    - [x] 緑のパルスエフェクト
    - [x] チェックマークのポップ
    - [x] 紙吹雪エフェクト（`showConfetti()`）
  - [x] **シームレスな完了切り替え**（全体再描画なし）
    - [x] `updateTodoItemVisualState()` 実装
    - [x] 既存アイテムのアニメーションスキップ

- [x] レスポンシブ対応
  - [x] モバイルレイアウト
  - [x] タブレットレイアウト
  - [x] デスクトップレイアウト

- [x] エラーメッセージ
  - [x] バリデーションエラー表示（フォーム内）
  - [x] 保存エラー表示（トースト通知）

- [x] 空状態の表示
  - [x] TODOがない時のメッセージ
  - [x] フィルター結果がない時のメッセージ

- [x] サブタスクの折りたたみ状態の保存
  - [x] LocalStorageに保存
  - [x] 再起動時に復元

### 8-1b. グループ管理の改善

- [x] **「すべて表示」ボタン**
  - [x] グループタブの左に独立したボタンとして配置
  - [x] 全グループのタスクを一覧表示
  - [x] アクティブ状態の視覚的表示

- [x] **グループ名変更機能**
  - [x] 編集ボタン（✎）をグループタブに追加
  - [x] ダブルクリックでも編集可能（既存機能）
  - [x] 編集・削除ボタンの視認性向上（背景色付き）

### 8-1c. タグ機能統合

- [x] **カテゴリとタグを「タグ」に統合**
  - [x] カテゴリフィールドを廃止
  - [x] 既存データのマイグレーション処理
  - [x] タスクに複数タグを割り当て可能

- [x] **サイドバーのタグフィルター**
  - [x] チェックボックス形式のタグ一覧
  - [x] OR条件でのフィルタリング（選択タグのいずれかを含む）
  - [x] タグ使用数の表示

- [x] **タグ管理モーダル**
  - [x] 新規タグ追加
  - [x] タグ名の編集
  - [x] タグの削除（確認ダイアログ付き）
  - [x] 使用中タスク数の表示

- [x] **TODOモーダル内のタグUI**
  - [x] チェックボックス形式のタグ選択
  - [x] インラインでの新規タグ追加

### 8-2. 統計情報

- [x] 全TODO数の表示
  - [x] サブタスク含む

- [x] 完了数/未完了数

- [x] 優先度別の数（未完了タスク）
  - [x] 高
  - [x] 中
  - [x] 低

- [x] 期限が近いTODOの数
  - [x] 期限切れ
  - [x] 今日が期限
  - [x] 明日が期限

- [x] 繰り返しタスクの数

- [x] サブタスク付きタスクの数

- [x] 詳細統計の折りたたみ表示

### 8-3. テスト

- [x] キーボードショートカットが機能
- [x] アニメーションが正常に動作
- [x] レスポンシブデザインが機能
- [x] エラーメッセージが表示される
- [x] 統計情報が正確

---

## フェーズ9: 仕上げ

### 9-1. README.mdの作成

- [x] アプリの説明
- [x] 機能一覧
- [x] 使い方
  - [x] 基本的な使い方
  - [x] サブタスクの使い方
  - [x] 繰り返しタスクの使い方
- [x] 今後の拡張予定

### 9-2. 最終調整

- [x] コードレビュー
  - [x] コメントの追加
  - [x] 未使用コードの削除
  - [x] 命名の統一

- [x] リファクタリング（スキップ - 現状で問題なし）
  - [x] 重複コードの削減
  - [x] 関数の分割
  - [x] 可読性の向上

- [x] パフォーマンス最適化
  - [x] DOM操作の最適化
  - [x] イベントリスナーの最適化
  - [x] 大量データでの動作確認

- [x] ブラウザ互換性確認
  - [x] Chrome
  - [x] Firefox
  - [x] Safari
  - [x] Edge

- [x] バグ修正
  - [x] 発見されたバグの修正
    - [x] ダークモードでの期限入力アイコン視認性
    - [x] タグ作成時のサイドバー更新
    - [x] タグ削除確認ダイアログのz-index
  - [x] エッジケースの対応

### 9-3. 最終テスト

- [x] 全機能が正常に動作
- [x] パフォーマンスが良好
- [x] ブラウザ互換性OK
- [x] レスポンシブデザインOK
- [x] アクセシビリティOK

---

## 完了

- [x] 全てのフェーズが完了
- [x] ドキュメントが整備されている
- [x] コードが整理されている
- [x] テストが完了している

**プロジェクト完了！** 🎉
